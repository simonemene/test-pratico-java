CREATE TABLE UTENTE (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  EMAIL VARCHAR(255) NOT NULL UNIQUE,
  NOME VARCHAR(100),
  COGNOME VARCHAR(100),
  CODICE_FISCALE VARCHAR(32) NOT NULL UNIQUE
);

CREATE TABLE PRODOTTO (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ID_PUBBLICO_PRODOTTO VARCHAR(36) NOT NULL UNIQUE,
  PREZZO NUMBER NOT NULL
);

CREATE TABLE ORDINE (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ID_UTENTE BIGINT NOT NULL,
  CONSTRAINT FK_ORDINE_UTENTE
    FOREIGN KEY (ID_UTENTE) REFERENCES UTENTE(ID)
);

CREATE TABLE STOCK (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ID_ORDINE BIGINT NOT NULL,
  ID_PRODOTTO BIGINT NOT NULL,
  QUANTITA NUMBER NOT NULL,
  CONSTRAINT FK_STOCK_ORDINE
    FOREIGN KEY (ID_ORDINE) REFERENCES ORDINE(ID),
  CONSTRAINT FK_STOCK_PRODOTTO
    FOREIGN KEY (ID_PRODOTTO) REFERENCES PRODOTTO(ID),
  CONSTRAINT UK_STOCK_ORDINE_PRODOTTO
    UNIQUE (ID_ORDINE, ID_PRODOTTO)
);

CREATE INDEX INDICE_ORDINE_UTENTE ON ORDINE(ID_UTENTE);
CREATE INDEX INDICE_STOCK_ORDINE ON STOCK(ID_ORDINE);
CREATE INDEX INDICE_STOCK_PRODOTTO ON STOCK(ID_PRODOTTO);
